<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="using dask and napari to process &amp; view large datasets" href="dask.html" /><link rel="prev" title="annotating segmentation with text and bounding boxes" href="annotate_segmentation.html" />

    <meta name="generator" content="sphinx-3.5.1, furo 2021.02.21.beta25"/>
        <title>annotating videos with napari - napari</title>
      <link rel="stylesheet" href="../../_static/styles/furo.css?digest=33d2fc4f3f180ec1ffc6524e273e21d7d58cbe49">
    <link rel="stylesheet" href="../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #002b36;
  --color-code-foreground: #839496;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #002b36;
  --color-code-foreground: #839496;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" href="../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">napari</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.ico" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">napari</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Use napari</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">napari tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../fundamentals/index.html">Fundamentals</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/installation.html">napari installation tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/getting_started.html">getting started with napari</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/viewer.html">napari viewer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/image.html">image layer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/labels.html">labels layer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/points.html">points layer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/shapes.html">shapes layer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/surface.html">surface layer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/tracks.html">tracks layer tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fundamentals/vectors.html">vectors layer tutorial</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Applications</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="annotate_segmentation.html">annotating segmentation with text and bounding boxes</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">annotating videos with napari</a></li>
<li class="toctree-l3"><a class="reference internal" href="dask.html">using dask and napari to process &amp; view large datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="napari_imageJ.html">Napari + ImageJ How-to-Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="cell_tracking.html">single cell tracking with napari</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../learn/stable/index.html">Learn</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/event_loop.html">An Introduction to the Event Loop in napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/threading.html">Multithreading in napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/perfmon.html">Performance Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/rendering.html">Rendering in napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/docker.html">Napari in Docker (WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/performance.html">Napari Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learn/stable/async.html">Asynchronous Rendering</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contribute to napari</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../community/index.html">Community</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../community/mission_and_values.html">Mission and Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/roadmap_0_4.html">Roadmap 0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/roadmap_0_3_retrospective.html">Roadmap 0.3 Retrospective</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/roadmap_0_3.html">Roadmap 0.3</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../release/index.html">Release notes</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_4_5.html">napari 0.4.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_4_4.html">napari 0.4.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_4_3.html">napari 0.4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_4_2.html">napari 0.4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_4_1.html">napari 0.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_4_0.html">napari 0.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_8.html">napari 0.3.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_7.html">napari 0.3.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_6.html">napari 0.3.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_5.html">napari 0.3.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_4.html">napari 0.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_3.html">napari 0.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_2.html">napari 0.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_1.html">napari 0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_3_0.html">napari 0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_9.html">napari 0.2.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_8.html">napari 0.2.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_7.html">napari 0.2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_6.html">napari 0.2.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_5.html">napari 0.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_4.html">napari 0.2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_3.html">napari 0.2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_12.html">napari 0.2.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_11.html">napari 0.2.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_10.html">napari 0.2.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_1.html">napari 0.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_2_0.html">napari 0.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_1_5.html">napari 0.1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_1_3.html">napari 0.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/release_0_1_0.html">napari 0.1.0</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../developers/index.html">Developer resources</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developers/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/code_of_conduct_reporting.html">Handling Code of Conduct Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/contributing.html">Contributing Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/core_dev_guide.html">Core Developer Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/governance.html">Governance Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/release.html">Release Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developers/testing.html">Testing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../plugins/stable/index.html">Extending napari</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/stable/for_napari_developers.html">napari plugin architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/stable/for_plugin_developers.html">creating a napari plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/stable/hook_specifications.html">napari hook specification reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/napari/napari">napari source code</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="annotating-videos-with-napari">
<h1>annotating videos with napari<a class="headerlink" href="#annotating-videos-with-napari" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will use napari (requires version 0.3.2 or greater) to make a simple GUI application for annotating points in videos.
This GUI could be useful for making annotations required to train algorithms for markless tracking of animals (e.g., <a class="reference external" href="http://www.mousemotorlab.org/deeplabcut">DeepLabCut</a>).
In this tutorial, we will cover creating and interacting with a Points layer with properties (i.e., labels for the points), connecting custom UI elements to events, and creating custom keybindings.</p>
<p>At the end of this tutorial, we will have created a GUI for annotating points in videos that we can simply call by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">im_path</span> <span class="o">=</span> <span class="s1">'&lt;path to directory with data&gt;/*.png'</span>
<span class="n">point_annotator</span><span class="p">(</span><span class="n">im_path</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">'ear_l'</span><span class="p">,</span> <span class="s1">'ear_r'</span><span class="p">,</span> <span class="s1">'tail'</span><span class="p">])</span>

</pre></div>
</div>
<p>The resulting viewer looks like this (images from <a class="reference external" href="https://www.nature.com/articles/s41593-018-0209-y">Mathis et al., 2018</a>, downloaded from <a class="reference external" href="https://github.com/DeepLabCut/DeepLabCut/tree/f21321ef8060c537f9df0ce9346189bda07701b5/examples/openfield-Pranav-2018-10-30/labeled-data/m4s1">here</a>):</p>
<p><img alt="image: point annotator demo" src="../../_images/point_annotator_demo.gif"/></p>
<p>You can explore the project in <a class="reference external" href="https://github.com/kevinyamauchi/PointAnnotator">this repository</a> or check out the main function below.
We will walk through the code in the following sections.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_label_menu</span><span class="p">(</span><span class="n">points_layer</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="sd">"""Create a label menu widget that can be added to the napari viewer dock</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    points_layer : napari.layers.Points</span>
<span class="sd">        a napari points layer</span>
<span class="sd">    labels : List[str]</span>
<span class="sd">        list of the labels for each keypoint to be annotated (e.g., the body parts to be labeled).</span>
<span class="sd">    """</span>
    <span class="c1"># Create the label selection menu</span>
    <span class="nd">@magicgui</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="p">{</span><span class="s1">'choices'</span><span class="p">:</span> <span class="n">labels</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">label_selection</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">label</span>

    <span class="n">label_menu</span> <span class="o">=</span> <span class="n">label_selection</span><span class="o">.</span><span class="n">Gui</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_label_menu</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Update the label menu when the point selection changes"""</span>
        <span class="n">label_menu</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">points_layer</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">current_properties</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_label_menu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">label_changed</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="sd">"""Update the Points layer when the label menu selection changes"""</span>
        <span class="n">selected_label</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">current_properties</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span>
        <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">selected_label</span><span class="p">])</span>
        <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span> <span class="o">=</span> <span class="n">current_properties</span>

    <span class="n">label_menu</span><span class="o">.</span><span class="n">label_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">label_changed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">label_menu</span>


<span class="k">def</span> <span class="nf">point_annotator</span><span class="p">(</span>
        <span class="n">im_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">):</span>
    <span class="sd">"""Create a GUI for annotating points in a series of images.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    im_path : str</span>
<span class="sd">        glob-like string for the images to be labeled.</span>
<span class="sd">    labels : List[str]</span>
<span class="sd">        list of the labels for each keypoint to be annotated (e.g., the body parts to be labeled).</span>
<span class="sd">    """</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">im_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">napari</span><span class="o">.</span><span class="n">gui_qt</span><span class="p">():</span>
        <span class="n">viewer</span> <span class="o">=</span> <span class="n">napari</span><span class="o">.</span><span class="n">view_image</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
        <span class="n">points_layer</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span>
            <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">'label'</span><span class="p">:</span> <span class="n">labels</span><span class="p">},</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s1">'label'</span><span class="p">,</span>
            <span class="n">edge_color_cycle</span><span class="o">=</span><span class="n">COLOR_CYCLE</span><span class="p">,</span>
            <span class="n">symbol</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span>
            <span class="n">face_color</span><span class="o">=</span><span class="s1">'transparent'</span><span class="p">,</span>
            <span class="n">edge_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">points_layer</span><span class="o">.</span><span class="n">edge_color_mode</span> <span class="o">=</span> <span class="s1">'cycle'</span>

        <span class="c1"># add the label menu widget to the viewer</span>
        <span class="n">label_menu</span> <span class="o">=</span> <span class="n">create_label_menu</span><span class="p">(</span><span class="n">points_layer</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_dock_widget</span><span class="p">(</span><span class="n">label_menu</span><span class="p">)</span>

        <span class="nd">@viewer</span><span class="o">.</span><span class="n">bind_key</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">next_label</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">"""Keybinding to advance to the next label with wraparound"""</span>
            <span class="n">current_properties</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span>
            <span class="n">current_label</span> <span class="o">=</span> <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">current_label</span><span class="p">)</span>
            <span class="n">new_ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="n">new_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span>
            <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_label</span><span class="p">])</span>
            <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span> <span class="o">=</span> <span class="n">current_properties</span>

        <span class="k">def</span> <span class="nf">next_on_click</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="sd">"""Mouse click binding to advance the label when a point is added"""</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">'add'</span><span class="p">:</span>
                <span class="n">next_label</span><span class="p">()</span>

                <span class="c1"># by default, napari selects the point that was just added</span>
                <span class="c1"># disable that behavior, as the highlight gets in the way</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">selected_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">points_layer</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">'add'</span>
        <span class="n">points_layer</span><span class="o">.</span><span class="n">mouse_drag_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_on_click</span><span class="p">)</span>

        <span class="nd">@viewer</span><span class="o">.</span><span class="n">bind_key</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">prev_label</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="sd">"""Keybinding to decrement to the previous label with wraparound"""</span>
            <span class="n">current_properties</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span>
            <span class="n">current_label</span> <span class="o">=</span> <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">current_label</span><span class="p">)</span>
            <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="n">new_ind</span> <span class="o">=</span> <span class="p">((</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_labels</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_labels</span>
            <span class="n">new_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span>
            <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_label</span><span class="p">])</span>
            <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span> <span class="o">=</span> <span class="n">current_properties</span>
</pre></div>
</div>
<div class="section" id="point-annotator">
<h2>point_annotator()<a class="headerlink" href="#point-annotator" title="Permalink to this headline">¶</a></h2>
<p>We will create the GUI within a function called <code class="docutils literal notranslate"><span class="pre">point_annotator()</span></code>.
Wrapping the GUI creation in the function allows us to integrate it into other functions (e.g., a command line interface) and applications.
See below for the function definition.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">point_annotator</span><span class="p">(</span>
    <span class="n">im_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">):</span>
    <span class="sd">"""Create a GUI for annotating points in a series of images.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    im_path : str</span>
<span class="sd">        glob-like string for the images to be labeled.</span>
<span class="sd">    labels : List[str]</span>
<span class="sd">        list of the labels for each keypoint to be annotated (e.g., the body parts to be labeled).</span>
<span class="sd">    """</span>

</pre></div>
</div>
</div>
<div class="section" id="loading-the-video">
<h2>Loading the video<a class="headerlink" href="#loading-the-video" title="Permalink to this headline">¶</a></h2>
<p>First, we load the movie to be annotated.
Since behavior movies can be quite long, we will use a lazy loading strategy (i.e., we will only load the frames as they are used).
Using <a class="reference external" href="https://github.com/dask/dask-image"><code class="docutils literal notranslate"><span class="pre">dask-image</span></code></a>, we can construct an object that we can pass to napari for lazy loading in just one line.
For more explanation on using dask to lazily load images in napari, see <a class="reference external" href="https://napari.org/tutorials/applications/dask">this</a> tutorial.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stack</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">im_path</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then start the viewer Note that we use the <code class="docutils literal notranslate"><span class="pre">napari.gui_qt()</span></code> context manager to start and manage Qt event loop.
All of the following GUI code should be within the <code class="docutils literal notranslate"><span class="pre">napari.gui_qt()</span></code> context manager.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">napari</span><span class="o">.</span><span class="n">gui_qt</span><span class="p">():</span>
    <span class="n">viewer</span> <span class="o">=</span> <span class="n">napari</span><span class="o">.</span><span class="n">view_image</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="annotating-with-points">
<h2>Annotating with points<a class="headerlink" href="#annotating-with-points" title="Permalink to this headline">¶</a></h2>
<p>We will annotate the features of interest using points in a napari Points layer.
Each feature will be given a different label so that we can track them across frames.
To achieve this, we will store the label in the <code class="docutils literal notranslate"><span class="pre">Points.properties</span></code> property in the ‘label’ key.
We will instantiate the <code class="docutils literal notranslate"><span class="pre">Points</span></code> layer without any points.
However, we will initialize <code class="docutils literal notranslate"><span class="pre">Points.properties</span></code> with the property values we will be using to annotate the images.
To do so, we will define a properties dictionary with a key named <code class="docutils literal notranslate"><span class="pre">label</span></code> and values <code class="docutils literal notranslate"><span class="pre">labels</span></code>.
The key, ‘label’, is the name of the property we are storing which feature of interest each point corresponds with.
The values, ‘labels’, is the list of the names of the features we will be annotating (defined above in the “point_annotator()” section).</p>
<p>We add the <code class="docutils literal notranslate"><span class="pre">Points</span></code> layer to the viewer using the <code class="docutils literal notranslate"><span class="pre">viewer.add_points()</span></code> method.
As discussed above, we will be storing which feature of interest each point corresponds to via the <code class="docutils literal notranslate"><span class="pre">label</span></code> property we defined in the <code class="docutils literal notranslate"><span class="pre">properties</span></code> dictionary.
To visualize the feature each point represents, we set the edge color as a color cycle mapped to the <code class="docutils literal notranslate"><span class="pre">label</span></code> property (<code class="docutils literal notranslate"><span class="pre">edge_color='label'</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'label'</span><span class="p">:</span> <span class="n">labels</span><span class="p">}</span>
<span class="n">points_layer</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span>
    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
    <span class="n">edge_color</span><span class="o">=</span><span class="s1">'label'</span><span class="p">,</span>
    <span class="n">edge_color_cycle</span><span class="o">=</span><span class="n">COLOR_CYCLE</span><span class="p">,</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span>
    <span class="n">face_color</span><span class="o">=</span><span class="s1">'transparent'</span><span class="p">,</span>
    <span class="n">edge_width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">12</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that we set the <code class="docutils literal notranslate"><span class="pre">edge_color_cycle</span></code> to <code class="docutils literal notranslate"><span class="pre">COLOR_CYCLE</span></code>.
You can define your own color cycle as a list of colors.
The colors can be defined as hex strings, standard color names or RGBA arrays.
For example, the <a class="reference external" href="https://github.com/d3/d3-3.x-api-reference/blob/master/Ordinal-Scales.md#category10">category10 color palette</a> would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">COLOR_CYCLE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'#1f77b4'</span><span class="p">,</span>
    <span class="s1">'#ff7f0e'</span><span class="p">,</span>
    <span class="s1">'#2ca02c'</span><span class="p">,</span>
    <span class="s1">'#d62728'</span><span class="p">,</span>
    <span class="s1">'#9467bd'</span><span class="p">,</span>
    <span class="s1">'#8c564b'</span><span class="p">,</span>
    <span class="s1">'#e377c2'</span><span class="p">,</span>
    <span class="s1">'#7f7f7f'</span><span class="p">,</span>
    <span class="s1">'#bcbd22'</span><span class="p">,</span>
    <span class="s1">'#17becf'</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Finally, we set the edge color to a color cycle:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">points_layer</span><span class="o">.</span><span class="n">edge_color_mode</span> <span class="o">=</span> <span class="s1">'cycle'</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-gui-for-selecting-points">
<h2>Adding a GUI for selecting points<a class="headerlink" href="#adding-a-gui-for-selecting-points" title="Permalink to this headline">¶</a></h2>
<p>First, we will define a function outside of the <code class="docutils literal notranslate"><span class="pre">napari.gui_qt()</span></code> context to create a GUI for select the labels for points.
The function <code class="docutils literal notranslate"><span class="pre">create_label_menu()</span></code> will take the points layer we created and the list of labels we will annotate with and return the label menu GUI.
Additionally, we will create and connect all the required callbacks to make the GUI interactive.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_label_menu</span><span class="p">(</span><span class="n">points_layer</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="sd">"""Create a label menu widget that can be added to the napari viewer dock</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    points_layer : napari.layers.Points</span>
<span class="sd">        a napari points layer</span>
<span class="sd">    labels : List[str]</span>
<span class="sd">        list of the labels for each keypoint to be annotated (e.g., the body parts to be labeled).</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    label_menu : QComboBox</span>
<span class="sd">        the label menu qt widget</span>
<span class="sd">    """</span>
</pre></div>
</div>
<p>Within <code class="docutils literal notranslate"><span class="pre">create_label_menu()</span></code>, we will use magicgui to add a dropdown menu for selecting which the label for the point we are about to add or the point we have selected.
<a class="reference external" href="https://github.com/napari/magicgui">magicgui</a> is a library from the napari team for building GUIs from functions and works by applying function decorators.
To make the a dropdown menu populated with the valid point labels, we simply define the function with the label as an input argument and then decorate it with the <code class="docutils literal notranslate"><span class="pre">magicgui()</span></code> decorator, passing the labels choice as <code class="docutils literal notranslate"><span class="pre">label={'choices':</span> <span class="pre">labels}</span></code> (recall that labels was passed to `point_annotator() as a list of the allowable labels).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@magicgui</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="p">{</span><span class="s1">'choices'</span><span class="p">:</span> <span class="n">labels</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">label_selection</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">label</span>
</pre></div>
</div>
<p>To create the GUI, we call the label_selection.
Gui() method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">label_menu</span> <span class="o">=</span> <span class="n">label_selection</span><span class="o">.</span><span class="n">Gui</span><span class="p">()</span>
</pre></div>
</div>
<p>We then need to connect the dropdown menu (<code class="docutils literal notranslate"><span class="pre">label_menu</span></code>) to the points layer to ensure the menu selection is always synchronized to the <code class="docutils literal notranslate"><span class="pre">Points</span></code> layer model.</p>
<p>First, we define a function to update the label dropdown menu GUI when the value of the selected point or next point to be added is changed.
On the points layer, the property values of the next point to be added are stored in the <code class="docutils literal notranslate"><span class="pre">current_properties</span></code> property.
The points layer has an event that gets emitted when the <code class="docutils literal notranslate"><span class="pre">current_properties</span></code> property is changed (<code class="docutils literal notranslate"><span class="pre">points_layer.events.current_properties</span></code>).
We connect the function we created to the event so that <code class="docutils literal notranslate"><span class="pre">update_label_menu()</span></code> is called whenever <code class="docutils literal notranslate"><span class="pre">Points.current_property</span></code> is changed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_label_menu</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="sd">"""Update the label menu when the point selection changes"""</span>
    <span class="n">label_menu</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">points_layer</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">current_properties</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_label_menu</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we define a function to update the points layer if the selection in the labels dropdown menu is changed.
Similar to the points layer, the magicgui object has an event that gets emitted whenever the selected label is changed (<code class="docutils literal notranslate"><span class="pre">label_menu.label_changed</span></code>).
To ensure the points layer is updated whenever the GUI selection is changed, we connect <code class="docutils literal notranslate"><span class="pre">label_changed()</span></code> to the <code class="docutils literal notranslate"><span class="pre">label_menu.label_changed</span></code> event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">label_changed</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="sd">"""Update the Points layer when the label menu selection changes"""</span>
    <span class="n">selected_label</span> <span class="o">=</span> <span class="n">result</span>
    <span class="n">current_properties</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span>
    <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">selected_label</span><span class="p">])</span>
    <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span> <span class="o">=</span> <span class="n">current_properties</span>

<span class="n">label_menu</span><span class="o">.</span><span class="n">label_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">label_changed</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we add the GUI created by magicgui to the napari viewer dock.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="c1"># add the label menu widget to the viewer</span>
<span class="n">label_menu</span> <span class="o">=</span> <span class="n">create_label_menu</span><span class="p">(</span><span class="n">points_layer</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add_dock_widget</span><span class="p">(</span><span class="n">label_menu</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="keybindings-for-switching-labels">
<h2>Keybindings for switching labels<a class="headerlink" href="#keybindings-for-switching-labels" title="Permalink to this headline">¶</a></h2>
<p>For convenience, we can also define functions to increment and decrement the currently selected label and bind them to key presses using the napari keybindings framework.</p>
<p>First, we define a function to increment to the next label and decorate it with the viewer key binding decorator.
The decorator requires that we pass the key to bind the function to as a string and the decorated function should take an event as an input argument.
In this case, we are binding <code class="docutils literal notranslate"><span class="pre">next_label()</span></code> to the <code class="docutils literal notranslate"><span class="pre">.</span></code> key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@viewer</span><span class="o">.</span><span class="n">bind_key</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">next_label</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Keybinding to advance to the next label with wraparound"""</span>

    <span class="c1"># get the currently selected label</span>
    <span class="n">current_properties</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span>
    <span class="n">current_label</span> <span class="o">=</span> <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># determine the index of that label in the labels list</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">current_label</span><span class="p">)</span>

    <span class="c1"># increment the label with wraparound</span>
    <span class="n">new_ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># get the new label and assign it</span>
    <span class="n">new_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span>
    <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_label</span><span class="p">])</span>
    <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span> <span class="o">=</span> <span class="n">current_properties</span>
</pre></div>
</div>
<p>We can do the same with another function that instead decrements the label with wraparound.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@viewer</span><span class="o">.</span><span class="n">bind_key</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">prev_label</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="sd">"""Keybinding to decrement to the previous label with wraparound"""</span>
    <span class="n">current_properties</span> <span class="o">=</span> <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span>
    <span class="n">current_label</span> <span class="o">=</span> <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">current_label</span><span class="p">)</span>
    <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">new_ind</span> <span class="o">=</span> <span class="p">((</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_labels</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_labels</span>
    <span class="n">new_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span>
    <span class="n">current_properties</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_label</span><span class="p">])</span>
    <span class="n">points_layer</span><span class="o">.</span><span class="n">current_properties</span> <span class="o">=</span> <span class="n">current_properties</span>
</pre></div>
</div>
</div>
<div class="section" id="mousebinding-to-iterate-through-labels">
<h2>Mousebinding to iterate through labels<a class="headerlink" href="#mousebinding-to-iterate-through-labels" title="Permalink to this headline">¶</a></h2>
<p>Like keybindings, we can also bind functions to mouse events such as clicking or dragging.
Here, we create a function that will increment the label after a point is added (i.e., the mouse is clicked in the viewer canvas when in the point adding mode).
This is convenient for quickly adding all labels to a frame, as one can simply click each feature in order without having to manually swap labels.
To achieve this, we first check if the points layer is the the adding mode (<code class="docutils literal notranslate"><span class="pre">layer.mode</span> <span class="pre">==</span> <span class="pre">'add'</span></code>).
If so, we then reuse the next_label() function we defined above in the keybindings to increment the label.
Finally,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_on_click</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="sd">"""Mouse click binding to advance the label when a point is added"""</span>
    <span class="c1"># only do something if we are adding points</span>
    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">'add'</span><span class="p">:</span>
        <span class="n">next_label</span><span class="p">()</span>

        <span class="c1"># by default, napari selects the point that was just added</span>
        <span class="c1"># disable that behavior, as the highlight gets in the way</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">selected_data</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>After creating the function, we then add it to the <code class="docutils literal notranslate"><span class="pre">points_layer</span></code> mouse drag callbacks.
In napari, clicking and dragging events are both handled under the <code class="docutils literal notranslate"><span class="pre">mouse_drag_callbacks</span></code>.
For more details on how mouse event callbacks work,
see the examples [<a class="reference external" href="https://github.com/napari/napari/blob/master/examples/custom_mouse_functions.py">1</a>, <a class="reference external" href="https://github.com/napari/napari/blob/master/examples/mouse_drag_callback.py">2</a>].</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># bind the callback to the mouse drag event</span>
<span class="n">points_layer</span><span class="o">.</span><span class="n">mouse_drag_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_on_click</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-gui">
<h2>Using the GUI<a class="headerlink" href="#using-the-gui" title="Permalink to this headline">¶</a></h2>
<div class="section" id="launching-the-gui">
<h3>Launching the GUI<a class="headerlink" href="#launching-the-gui" title="Permalink to this headline">¶</a></h3>
<p>Now that you’ve put it all together, you should be ready to test! You can call the function as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">im_path</span> <span class="o">=</span> <span class="s1">'&lt;path to directory with data&gt;/*.png'</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">'&lt;path to directory with data&gt;/annotations.csv'</span>
<span class="n">point_annotator</span><span class="p">(</span><span class="n">im_path</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">'ear_l'</span><span class="p">,</span> <span class="s1">'ear_r'</span><span class="p">,</span> <span class="s1">'tail'</span><span class="p">],</span> <span class="n">output_path</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="section" id="saving-the-annotations">
<h3>Saving the annotations<a class="headerlink" href="#saving-the-annotations" title="Permalink to this headline">¶</a></h3>
<p>Once we are happy with the annotations, we can save them to a CSV file using the builing CSV writer for the points layer.
To do so, first, select the “Points” layer in the layer list and then click “Save Selected layer(s)”  in the “File” menu or press control+S (cmd+S on Mac OS)  to bring up the file save dialog.
From here you can enter the file path and save the annotation coordinates as a CSV.</p>
<p><img alt="image: points save dialog" src="../../_images/points_save_dialog.png"/></p>
<p>Alternatively, we can use the <code class="docutils literal notranslate"><span class="pre">points_layer.save()</span></code> method to save the coordinates from the points layer to a CSV file.
We can enter the command either in the script (e.g., bind a save function to a hot key) or the napari terminal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">points_layer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'path/to/file.csv'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/applications"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="dask.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">using dask and napari to process &amp; view large datasets</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="annotate_segmentation.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">annotating segmentation with text and bounding boxes</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../_sources/tutorials/applications/annotate_points.md"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">annotating videos with napari</a><ul>
<li><a class="reference internal" href="#point-annotator">point_annotator()</a></li>
<li><a class="reference internal" href="#loading-the-video">Loading the video</a></li>
<li><a class="reference internal" href="#annotating-with-points">Annotating with points</a></li>
<li><a class="reference internal" href="#adding-a-gui-for-selecting-points">Adding a GUI for selecting points</a></li>
<li><a class="reference internal" href="#keybindings-for-switching-labels">Keybindings for switching labels</a></li>
<li><a class="reference internal" href="#mousebinding-to-iterate-through-labels">Mousebinding to iterate through labels</a></li>
<li><a class="reference internal" href="#using-the-gui">Using the GUI</a><ul>
<li><a class="reference internal" href="#launching-the-gui">Launching the GUI</a></li>
<li><a class="reference internal" href="#saving-the-annotations">Saving the annotations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>